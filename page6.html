<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<title>نظام إدارة العملاء والطلبات والصيانة</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Cairo', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); direction: rtl; min-height: 100vh; padding: 20px; color: #333; }
.container { max-width: 1600px; margin: 0 auto; }
.header { text-align: center; margin-bottom: 40px; color: white; }
.header h1 { font-size: 2.8rem; margin-bottom: 10px; font-weight: 700; text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); }
.header p { font-size: 1.2rem; opacity: 0.9; max-width: 800px; margin: 0 auto; }
.tabs-container { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px; padding: 0; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2); margin-bottom: 40px; border: 1px solid rgba(255, 255, 255, 0.2); overflow: hidden; }
.tabs-header { display: flex; background: linear-gradient(to right, #667eea, #764ba2); padding: 0; flex-wrap: wrap; }
.tab-btn { flex: 1; min-width: 200px; padding: 20px; font-size: 1.1rem; border: none; background: transparent; color: rgba(255, 255, 255, 0.8); cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-family: 'Cairo', sans-serif; position: relative; }
.tab-btn:hover { color: white; background: rgba(255, 255, 255, 0.1); }
.tab-btn.active { color: white; background: rgba(255, 255, 255, 0.2); }
.tab-btn.active::after { content: ''; position: absolute; bottom: 0; right: 0; width: 100%; height: 4px; background: white; }
.tab-content { padding: 40px; display: none; }
.tab-content.active { display: block; animation: fadeIn 0.5s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.form-container { background: #f5f7ff; border-radius: 15px; padding: 30px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); }
.form-title { font-size: 1.5rem; color: #764ba2; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #e6e9ff; font-weight: 700; }
.form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
.form-group { display: flex; flex-direction: column; }
.form-group label { margin-bottom: 8px; font-weight: 600; color: #555; font-size: 1rem; }
.form-group input, .form-group select, .form-group textarea { padding: 15px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; font-family: 'Cairo', sans-serif; transition: all 0.3s ease; background: white; }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); }
.form-group textarea { resize: vertical; min-height: 120px; }
.form-actions { display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px; }
.btn { padding: 15px 30px; border: none; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; font-family: 'Cairo', sans-serif; }
.btn-primary { background: linear-gradient(to right, #667eea, #764ba2); color: white; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); }
.btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4); }
.btn-secondary { background: #f0f5ff; color: #667eea; border: 1px solid #667eea; }
.btn-secondary:hover { background: #e6e9ff; }
.btn-success { background: linear-gradient(to right, #4CAF50, #45a049); color: white; box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3); }
.btn-success:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4); }
.btn-warning { background: linear-gradient(to right, #FF9800, #F57C00); color: white; box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3); }
.btn-warning:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4); }
.btn-info { background: linear-gradient(to right, #2196F3, #1976D2); color: white; box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3); }
.btn-info:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(33, 150, 243, 0.4); }
.data-container { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); margin-top: 30px; }
.search-box-container { margin-bottom: 30px; position: relative; }
.search-box { width: 100%; padding: 18px 60px 18px 25px; font-size: 1.1rem; border: none; border-radius: 12px; background: #f5f7ff; box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05); transition: all 0.3s ease; font-family: 'Cairo', sans-serif; }
.search-box:focus { outline: none; box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1), 0 0 0 3px rgba(102, 126, 234, 0.2); background: white; }
.search-icon { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: #764ba2; font-size: 1.2rem; }
.stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
.stat-card { background: linear-gradient(135deg, #f5f7ff 0%, #e3e9ff 100%); border-radius: 15px; padding: 25px; text-align: center; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); border-left: 5px solid #667eea; transition: all 0.3s ease; }
.stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1); }
.stat-card h3 { font-size: 2rem; font-weight: 800; color: #333; margin-bottom: 5px; }
.stat-card p { font-size: 1rem; color: #764ba2; font-weight: 600; }
.customers-container, .maintenance-container, .orders-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; margin-top: 30px; }
.customer-card, .maintenance-card, .order-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); transition: all 0.3s ease; position: relative; display: flex; flex-direction: column; }
.customer-card:hover, .maintenance-card:hover, .order-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12); }
.customer-card { border-top: 5px solid #667eea; }
.customer-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0; }
.customer-name { font-size: 1.4rem; font-weight: 700; color: #333; line-height: 1.3; }
.customer-type { display: inline-block; padding: 5px 12px; border-radius: 20px; font-weight: 600; font-size: 0.85rem; margin-top: 5px; }
.type-normal { background: #f5f5f5; color: #666; }
.type-vip { background: linear-gradient(to right, #ffd93d, #ffc107); color: #333; }
.type-wholesale { background: linear-gradient(to right, #4fc3f7, #039be5); color: white; }
.type-company { background: linear-gradient(to right, #9575cd, #673ab7); color: white; }
.customer-details { margin-bottom: 20px; flex-grow: 1; }
.customer-details p { margin-bottom: 10px; line-height: 1.6; color: #555; display: flex; align-items: center; }
.customer-details i { margin-left: 8px; color: #764ba2; width: 20px; text-align: center; }
.customer-stats { display: flex; justify-content: space-between; margin-top: 10px; }
.customer-stat { background: #f0f5ff; padding: 8px 15px; border-radius: 20px; font-weight: 600; color: #667eea; font-size: 0.9rem; }
.customer-actions { display: flex; gap: 10px; margin-top: 20px; justify-content: space-between; }
.maintenance-card { border-top: 5px solid #FF9800; }
.maintenance-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0; }
.maintenance-customer { font-size: 1.3rem; font-weight: 700; color: #333; }
.maintenance-date { font-size: 0.9rem; color: #888; background: #f5f5f5; padding: 5px 10px; border-radius: 20px; }
.maintenance-details { margin-bottom: 20px; flex-grow: 1; }
.maintenance-details p { margin-bottom: 10px; line-height: 1.6; color: #555; }
.maintenance-device { font-weight: 700; color: #FF9800; font-size: 1.1rem; margin-bottom: 5px; }
.maintenance-problem { background: #fff3e0; padding: 10px; border-radius: 8px; margin: 10px 0; border-right: 3px solid #FF9800; }
.maintenance-status { display: inline-block; padding: 8px 15px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; }
.status-received { background: #e3f2fd; color: #1976d2; }
.status-diagnosis { background: #fff3e0; color: #f57c00; }
.status-repair { background: #f3e5f5; color: #7b1fa2; }
.status-ready { background: #e8f5e9; color: #388e3c; }
.status-delivered { background: #f5f5f5; color: #666; }
.maintenance-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
.maintenance-cost { font-weight: 700; color: #333; font-size: 1.1rem; }
.order-card { border-top: 5px solid #4CAF50; }
.order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0; }
.order-customer { font-size: 1.3rem; font-weight: 700; color: #333; }
.order-date { font-size: 0.9rem; color: #888; background: #f5f5f5; padding: 5px 10px; border-radius: 20px; }
.order-details { margin-bottom: 20px; flex-grow: 1; }
.order-details p { margin-bottom: 10px; line-height: 1.6; color: #555; }
.order-status { display: inline-block; padding: 8px 15px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; }
.status-pending { background: #fff3e0; color: #f57c00; }
.status-processing { background: #e3f2fd; color: #1976d2; }
.status-completed { background: #e8f5e9; color: #388e3c; }
.status-cancelled { background: #ffebee; color: #d32f2f; }
.order-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
.order-priority { color: #888; font-size: 0.9rem; font-weight: 600; }
.priority-normal { color: #4CAF50; }
.priority-medium { color: #FF9800; }
.priority-high { color: #F44336; }
.action-btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; font-family: 'Cairo', sans-serif; display: flex; align-items: center; justify-content: center; gap: 5px; flex: 1; }
.action-btn.view { background: #e3f2fd; color: #1976d2; }
.action-btn.edit { background: #f3e5f5; color: #7b1fa2; }
.action-btn.delete { background: #ffebee; color: #d32f2f; }
.action-btn.update { background: #fff3e0; color: #f57c00; }
.action-btn.complete { background: #e8f5e9; color: #388e3c; }
.action-btn:hover { transform: translateY(-2px); box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); }
.no-data { text-align: center; padding: 50px 20px; color: #888; font-size: 1.2rem; grid-column: 1 / -1; }
.no-data i { font-size: 3rem; color: #ddd; margin-bottom: 15px; }
.alert { padding: 15px 20px; border-radius: 10px; margin-bottom: 25px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
.alert-success { background: #e8f5e9; color: #2e7d32; border-right: 4px solid #4CAF50; }
.alert-error { background: #ffebee; color: #c62828; border-right: 4px solid #f44336; }
.alert-info { background: #e3f2fd; color: #1565c0; border-right: 4px solid #2196F3; }
.alert-warning { background: #fff3e0; color: #f57c00; border-right: 4px solid #FF9800; }
.footer { text-align: center; color: rgba(255, 255, 255, 0.8); margin-top: 50px; padding: 20px; font-size: 0.9rem; }
.loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 2000; color: white; flex-direction: column; gap: 20px; }
.spinner { width: 60px; height: 60px; border: 5px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #667eea; animation: spin 1s ease-in-out infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
@media (max-width: 768px) {
  .header h1 { font-size: 2.2rem; }
  .tabs-header { flex-direction: column; }
  .tab-btn { width: 100%; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
  .tab-content { padding: 25px; }
  .form-row { grid-template-columns: 1fr; }
  .customers-container, .maintenance-container, .orders-container { grid-template-columns: 1fr; }
  .form-actions { flex-direction: column; }
  .customer-actions, .maintenance-actions, .order-actions { flex-direction: column; gap: 10px; }
  .stats-container { grid-template-columns: 1fr; }
}
@media (min-width: 992px) {
  .customers-container, .maintenance-container, .orders-container { grid-template-columns: repeat(2, 1fr); }
}
@media (min-width: 1200px) {
  .customers-container, .maintenance-container, .orders-container { grid-template-columns: repeat(3, 1fr); }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1><i class="fas fa-users"></i> نظام إدارة العملاء والطلبات والصيانة</h1>
    <p>إدارة كاملة للعملاء، طلبات المحل، واستلام الأجهزة للصيانة</p>
  </div>
  
  <div class="tabs-container">
    <div class="tabs-header">
      <button class="tab-btn active" data-tab="customers-tab">
        <i class="fas fa-user-plus"></i> إضافة عميل جديد
      </button>
      <button class="tab-btn" data-tab="orders-tab">
        <i class="fas fa-shopping-cart"></i> إضافة طلب جديد
      </button>
      <button class="tab-btn" data-tab="maintenance-tab">
        <i class="fas fa-tools"></i> استلام جهاز للصيانة
      </button>
      <button class="tab-btn" data-tab="view-tab">
        <i class="fas fa-list"></i> عرض الكل
      </button>
    </div>
    
    <!-- تبويب إضافة عميل جديد -->
    <div id="customers-tab" class="tab-content active">
      <div class="form-container">
        <h3 class="form-title"><i class="fas fa-user-plus"></i> بيانات العميل الجديد</h3>
        <div id="customer-alert" class="alert" style="display: none;"></div>
        <div class="form-row">
          <div class="form-group"><label for="customer-name"><i class="fas fa-user"></i> اسم العميل *</label><input type="text" id="customer-name" placeholder="أدخل اسم العميل الكامل"></div>
          <div class="form-group"><label for="customer-phone"><i class="fas fa-phone"></i> رقم الهاتف *</label><input type="tel" id="customer-phone" placeholder="أدخل رقم الهاتف"></div>
          <div class="form-group"><label for="customer-email"><i class="fas fa-envelope"></i> البريد الإلكتروني</label><input type="email" id="customer-email" placeholder="أدخل البريد الإلكتروني"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="customer-address"><i class="fas fa-map-marker-alt"></i> العنوان</label><input type="text" id="customer-address" placeholder="أدخل عنوان العميل"></div>
          <div class="form-group"><label for="customer-type"><i class="fas fa-tag"></i> نوع العميل</label>
            <select id="customer-type"><option value="عادي">عميل عادي</option><option value="مميز">عميل مميز</option><option value="جملة">عميل جملة</option><option value="شركة">شركة</option></select>
          </div>
          <div class="form-group"><label for="customer-reg-date"><i class="fas fa-calendar"></i> تاريخ التسجيل</label><input type="date" id="customer-reg-date"></div>
        </div>
        <div class="form-row">
          <div class="form-group" style="grid-column: 1 / -1;"><label for="customer-notes"><i class="fas fa-sticky-note"></i> ملاحظات إضافية</label><textarea id="customer-notes" placeholder="أي ملاحظات إضافية عن العميل..."></textarea></div>
        </div>
        <div class="form-actions">
          <button class="btn btn-secondary" onclick="clearCustomerForm()"><i class="fas fa-eraser"></i> مسح النموذج</button>
          <button class="btn btn-primary" onclick="addCustomer()"><i class="fas fa-save"></i> حفظ العميل</button>
        </div>
      </div>
    </div>
    
    <!-- تبويب إضافة طلب جديد -->
    <div id="orders-tab" class="tab-content">
      <div class="form-container">
        <h3 class="form-title"><i class="fas fa-shopping-cart"></i> بيانات الطلب الجديد</h3>
        <div id="order-alert" class="alert" style="display: none;"></div>
        <div class="form-row">
          <div class="form-group"><label for="order-customer"><i class="fas fa-user"></i> اختر العميل *</label><select id="order-customer"><option value="">-- اختر العميل --</option></select></div>
          <div class="form-group"><label for="order-date"><i class="fas fa-calendar"></i> تاريخ الطلب *</label><input type="date" id="order-date"></div>
          <div class="form-group"><label for="order-due-date"><i class="fas fa-calendar-alt"></i> تاريخ التسليم</label><input type="date" id="order-due-date"></div>
        </div>
        <div class="form-row">
          <div class="form-group" style="grid-column: 1 / -1;"><label for="order-items"><i class="fas fa-boxes"></i> المطلوب من المحل *</label><textarea id="order-items" placeholder="صف تفاصيل المطلوب من المحل بالتفصيل..."></textarea></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="order-amount"><i class="fas fa-money-bill-wave"></i> المبلغ (ريال)</label><input type="number" id="order-amount" placeholder="أدخل المبلغ"></div>
          <div class="form-group"><label for="order-status"><i class="fas fa-info-circle"></i> حالة الطلب</label><select id="order-status"><option value="معلق">معلق</option><option value="قيد التنفيذ">قيد التنفيذ</option><option value="منتهي">منتهي</option><option value="ملغى">ملغى</option></select></div>
          <div class="form-group"><label for="order-priority"><i class="fas fa-exclamation-circle"></i> أولوية الطلب</label><select id="order-priority"><option value="عادية">عادية</option><option value="متوسطة">متوسطة</option><option value="عاجلة">عاجلة</option></select></div>
        </div>
        <div class="form-actions">
          <button class="btn btn-secondary" onclick="clearOrderForm()"><i class="fas fa-eraser"></i> مسح النموذج</button>
          <button class="btn btn-success" onclick="addOrder()"><i class="fas fa-plus-circle"></i> إضافة الطلب</button>
        </div>
      </div>
    </div>
    
    <!-- تبويب استلام جهاز للصيانة -->
    <div id="maintenance-tab" class="tab-content">
      <div class="form-container">
        <h3 class="form-title"><i class="fas fa-tools"></i> استلام جهاز للصيانة</h3>
        <div id="maintenance-alert" class="alert" style="display: none;"></div>
        <div class="form-row">
          <div class="form-group"><label for="maintenance-customer"><i class="fas fa-user"></i> اختر العميل *</label><select id="maintenance-customer"><option value="">-- اختر العميل --</option></select></div>
          <div class="form-group"><label for="maintenance-date"><i class="fas fa-calendar"></i> تاريخ الاستلام *</label><input type="date" id="maintenance-date"></div>
          <div class="form-group"><label for="maintenance-expected-date"><i class="fas fa-calendar-alt"></i> تاريخ التسليم المتوقع</label><input type="date" id="maintenance-expected-date"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="maintenance-device-type"><i class="fas fa-laptop"></i> نوع الجهاز *</label>
            <select id="maintenance-device-type">
              <option value="">-- اختر نوع الجهاز --</option>
              <option value="لابتوب">لابتوب</option><option value="كمبيوتر مكتبي">كمبيوتر مكتبي</option>
              <option value="هاتف محمول">هاتف محمول</option><option value="تابلت">تابلت</option>
              <option value="طابعة">طابعة</option><option value="شاشة">شاشة</option>
              <option value="أخرى">أخرى</option>
            </select>
          </div>
          <div class="form-group"><label for="maintenance-device-brand"><i class="fas fa-tag"></i> ماركة الجهاز</label><input type="text" id="maintenance-device-brand" placeholder="أدخل ماركة الجهاز"></div>
          <div class="form-group"><label for="maintenance-device-model"><i class="fas fa-microchip"></i> موديل الجهاز</label><input type="text" id="maintenance-device-model" placeholder="أدخل موديل الجهاز"></div>
        </div>
        <div class="form-row">
          <div class="form-group" style="grid-column: 1 / -1;"><label for="maintenance-problem"><i class="fas fa-exclamation-triangle"></i> وصف المشكلة *</label><textarea id="maintenance-problem" placeholder="صف المشكلة التي يعاني منها الجهاز بالتفصيل..."></textarea></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="maintenance-status"><i class="fas fa-info-circle"></i> حالة الصيانة</label>
            <select id="maintenance-status">
              <option value="مستلم">مستلم</option><option value="قيد التشخيص">قيد التشخيص</option>
              <option value="قيد الإصلاح">قيد الإصلاح</option><option value="جاهز للتسليم">جاهز للتسليم</option>
              <option value="مسلم">مسلم</option>
            </select>
          </div>
          <div class="form-group"><label for="maintenance-cost"><i class="fas fa-money-bill-wave"></i> التكلفة المتوقعة (ريال)</label><input type="number" id="maintenance-cost" placeholder="أدخل التكلفة المتوقعة"></div>
          <div class="form-group"><label for="maintenance-priority"><i class="fas fa-exclamation-circle"></i> أولوية الصيانة</label><select id="maintenance-priority"><option value="عادية">عادية</option><option value="متوسطة">متوسطة</option><option value="عاجلة">عاجلة</option></select></div>
        </div>
        <div class="form-row">
          <div class="form-group" style="grid-column: 1 / -1;"><label for="maintenance-notes"><i class="fas fa-sticky-note"></i> ملاحظات إضافية</label><textarea id="maintenance-notes" placeholder="أي ملاحظات إضافية عن الصيانة..."></textarea></div>
        </div>
        <div class="form-actions">
          <button class="btn btn-secondary" onclick="clearMaintenanceForm()"><i class="fas fa-eraser"></i> مسح النموذج</button>
          <button class="btn btn-warning" onclick="addMaintenance()"><i class="fas fa-tools"></i> استلام الجهاز</button>
        </div>
      </div>
    </div>
    
    <!-- تبويب عرض الكل -->
    <div id="view-tab" class="tab-content">
      <div class="data-container">
        <div class="search-box-container">
          <div class="search-icon"><i class="fas fa-search"></i></div>
          <input type="text" class="search-box" id="search-input" placeholder="ابحث عن عميل أو طلب أو جهاز صيانة...">
        </div>
        <div class="form-actions" style="margin-bottom: 20px;">
          <button class="btn btn-info" onclick="loadAllData()"><i class="fas fa-sync-alt"></i> تحديث البيانات</button>
        </div>
        <div class="stats-container">
          <div class="stat-card"><h3 id="total-customers">0</h3><p>إجمالي العملاء</p></div>
          <div class="stat-card"><h3 id="total-orders">0</h3><p>إجمالي الطلبات</p></div>
          <div class="stat-card"><h3 id="total-maintenance">0</h3><p>أجهزة صيانة</p></div>
          <div class="stat-card"><h3 id="pending-maintenance">0</h3><p>صيانة معلقة</p></div>
        </div>
        <div class="form-container">
          <h3 class="form-title"><i class="fas fa-users"></i> قائمة العملاء</h3>
          <div class="customers-container" id="customers-container"></div>
          <div id="no-customers" class="no-data" style="display: none;"><i class="fas fa-user-slash"></i><p>لا يوجد عملاء مسجلين بعد</p></div>
        </div>
        <div class="form-container" style="margin-top: 40px;">
          <h3 class="form-title"><i class="fas fa-tools"></i> أجهزة الصيانة</h3>
          <div class="maintenance-container" id="maintenance-container"></div>
          <div id="no-maintenance" class="no-data" style="display: none;"><i class="fas fa-tools"></i><p>لا توجد أجهزة مسجلة للصيانة بعد</p></div>
        </div>
        <div class="form-container" style="margin-top: 40px;">
          <h3 class="form-title"><i class="fas fa-shopping-bag"></i> أحدث الطلبات</h3>
          <div class="orders-container" id="orders-container"></div>
          <div id="no-orders" class="no-data" style="display: none;"><i class="fas fa-shopping-basket"></i><p>لا توجد طلبات مسجلة بعد</p></div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="footer">
    <p>جميع الحقوق محفوظة © 2025 | نظام إدارة العملاء والطلبات والصيانة</p>
  </div>
</div>

<div id="loading-overlay" class="loading-overlay" style="display: none;">
  <div class="spinner"></div>
  <p id="loading-message">جاري معالجة طلبك...</p>
</div>

<script>
// ========== الإعدادات التلقائية ==========
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbydFIBpXL6vRfYOt7R5zHfXb-FouKQ_H_ASw_GPf5oCFZW-e-cCtcOoDPfoVFFWz8Y/exec';
const GOOGLE_SHEET_ID = '1GZ9IoXTSOnEW0LCkT9XApOT62HlSPBdnTaccOM8UnnU';

// ========== البيانات ==========
let customers = [];
let orders = [];
let maintenance = [];

// ========== عند تحميل الصفحة ==========
document.addEventListener('DOMContentLoaded', function() {
  // تعيين تاريخ اليوم
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('customer-reg-date').value = today;
  document.getElementById('order-date').value = today;
  document.getElementById('maintenance-date').value = today;
  
  // تهيئة التبويبات
  initTabs();
  
  // إضافة مستمع للبحث
  document.getElementById('search-input').addEventListener('input', updateView);
  
  // تحميل البيانات تلقائياً
  setTimeout(() => {
    loadAllData();
  }, 500);
});

// ========== تهيئة التبويبات ==========
function initTabs() {
  const tabBtns = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const tabId = this.getAttribute('data-tab');
      tabBtns.forEach(b => b.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      this.classList.add('active');
      document.getElementById(tabId).classList.add('active');
      if (tabId === 'view-tab') updateView();
    });
  });
}

// ========== استدعاء Google Script ==========
async function callGoogleScript(action, params = {}) {
  let url = GOOGLE_SCRIPT_URL;
  const allParams = { action, ...params };
  const queryString = Object.keys(allParams)
    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(allParams[key])}`)
    .join('&');
  url += (url.includes('?') ? '&' : '?') + queryString;
  
  const response = await fetch(url);
  if (!response.ok) throw new Error(`فشل الطلب: ${response.status}`);
  return await response.json();
}

// ========== تحميل جميع البيانات ==========
async function loadAllData() {
  showLoading('جاري تحميل البيانات...');
  try {
    // تحميل العملاء
    const customersResponse = await callGoogleScript('getCustomers');
    if (customersResponse.success) {
      customers = customersResponse.data || [];
      updateCustomersSelect();
    }
    
    // تحميل الطلبات
    const ordersResponse = await callGoogleScript('getOrders');
    if (ordersResponse.success) orders = ordersResponse.data || [];
    
    // تحميل الصيانة
    const maintenanceResponse = await callGoogleScript('getMaintenance');
    if (maintenanceResponse.success) maintenance = maintenanceResponse.data || [];
    
    hideLoading();
    updateView();
    showAlert('customer-alert', 'تم تحميل البيانات بنجاح', 'success');
    
  } catch (error) {
    hideLoading();
    console.error('❌ خطأ في تحميل البيانات:', error);
    showAlert('customer-alert', 'فشل تحميل البيانات: ' + error.message, 'error');
  }
}

// ========== تحديث قوائم اختيار العملاء ==========
function updateCustomersSelect() {
  const orderSelect = document.getElementById('order-customer');
  const maintenanceSelect = document.getElementById('maintenance-customer');
  if (!orderSelect || !maintenanceSelect) return;
  
  orderSelect.innerHTML = '<option value="">-- اختر العميل --</option>';
  maintenanceSelect.innerHTML = '<option value="">-- اختر العميل --</option>';
  
  customers.forEach(customer => {
    const option1 = document.createElement('option');
    option1.value = customer.ID;
    option1.textContent = `${customer.الاسم || ''} - ${customer.الهاتف || ''}`;
    orderSelect.appendChild(option1);
    
    const option2 = document.createElement('option');
    option2.value = customer.ID;
    option2.textContent = `${customer.الاسم || ''} - ${customer.الهاتف || ''}`;
    maintenanceSelect.appendChild(option2);
  });
}

// ========== إضافة عميل جديد ==========
async function addCustomer() {
  const name = document.getElementById('customer-name').value.trim();
  const phone = document.getElementById('customer-phone').value.trim();
  if (!name || !phone) {
    showAlert('customer-alert', 'يرجى ملء اسم العميل ورقم الهاتف', 'error');
    return;
  }
  
  showLoading('جاري إضافة العميل...');
  try {
    const params = {
      name,
      phone,
      email: document.getElementById('customer-email').value.trim(),
      address: document.getElementById('customer-address').value.trim(),
      type: document.getElementById('customer-type').value,
      regDate: document.getElementById('customer-reg-date').value,
      notes: document.getElementById('customer-notes').value.trim()
    };
    
    const response = await callGoogleScript('addCustomer', params);
    if (response.success) {
      showAlert('customer-alert', response.message || 'تم إضافة العميل بنجاح!', 'success');
      await loadAllData();
      clearCustomerForm();
    } else {
      showAlert('customer-alert', response.error || 'فشل إضافة العميل', 'error');
    }
  } catch (error) {
    showAlert('customer-alert', 'فشل إضافة العميل: ' + error.message, 'error');
  }
  hideLoading();
}

// ========== إضافة طلب جديد ==========
async function addOrder() {
  const customerId = document.getElementById('order-customer').value;
  const items = document.getElementById('order-items').value.trim();
  if (!customerId || !items) {
    showAlert('order-alert', 'يرجى اختيار العميل وكتابة المطلوب', 'error');
    return;
  }
  
  const customer = customers.find(c => c.ID === customerId);
  if (!customer) {
    showAlert('order-alert', 'العميل غير موجود', 'error');
    return;
  }
  
  showLoading('جاري إضافة الطلب...');
  try {
    const params = {
      customerId,
      customerName: customer.الاسم || '',
      customerPhone: customer.الهاتف || '',
      date: document.getElementById('order-date').value,
      dueDate: document.getElementById('order-due-date').value,
      items,
      amount: document.getElementById('order-amount').value || 0,
      status: document.getElementById('order-status').value,
      priority: document.getElementById('order-priority').value
    };
    
    const response = await callGoogleScript('addOrder', params);
    if (response.success) {
      showAlert('order-alert', response.message || 'تم إضافة الطلب بنجاح!', 'success');
      await loadAllData();
      clearOrderForm();
    } else {
      showAlert('order-alert', response.error || 'فشل إضافة الطلب', 'error');
    }
  } catch (error) {
    showAlert('order-alert', 'فشل إضافة الطلب: ' + error.message, 'error');
  }
  hideLoading();
}

// ========== إضافة صيانة جديدة ==========
async function addMaintenance() {
  const customerId = document.getElementById('maintenance-customer').value;
  const deviceType = document.getElementById('maintenance-device-type').value;
  const problem = document.getElementById('maintenance-problem').value.trim();
  if (!customerId || !deviceType || !problem) {
    showAlert('maintenance-alert', 'يرجى اختيار العميل ونوع الجهاز وكتابة المشكلة', 'error');
    return;
  }
  
  const customer = customers.find(c => c.ID === customerId);
  if (!customer) {
    showAlert('maintenance-alert', 'العميل غير موجود', 'error');
    return;
  }
  
  showLoading('جاري إضافة الصيانة...');
  try {
    const params = {
      customerId,
      customerName: customer.الاسم || '',
      customerPhone: customer.الهاتف || '',
      date: document.getElementById('maintenance-date').value,
      expectedDate: document.getElementById('maintenance-expected-date').value,
      deviceType,
      deviceBrand: document.getElementById('maintenance-device-brand').value.trim(),
      deviceModel: document.getElementById('maintenance-device-model').value.trim(),
      problem,
      status: document.getElementById('maintenance-status').value,
      cost: document.getElementById('maintenance-cost').value || 0,
      priority: document.getElementById('maintenance-priority').value,
      notes: document.getElementById('maintenance-notes').value.trim()
    };
    
    const response = await callGoogleScript('addMaintenance', params);
    if (response.success) {
      showAlert('maintenance-alert', response.message || 'تم إضافة الصيانة بنجاح!', 'success');
      await loadAllData();
      clearMaintenanceForm();
    } else {
      showAlert('maintenance-alert', response.error || 'فشل إضافة الصيانة', 'error');
    }
  } catch (error) {
    showAlert('maintenance-alert', 'فشل إضافة الصيانة: ' + error.message, 'error');
  }
  hideLoading();
}

// ========== مسح النماذج ==========
function clearCustomerForm() {
  document.getElementById('customer-name').value = '';
  document.getElementById('customer-phone').value = '';
  document.getElementById('customer-email').value = '';
  document.getElementById('customer-address').value = '';
  document.getElementById('customer-type').value = 'عادي';
  document.getElementById('customer-notes').value = '';
  document.getElementById('customer-reg-date').value = new Date().toISOString().split('T')[0];
  document.getElementById('customer-alert').style.display = 'none';
}

function clearOrderForm() {
  document.getElementById('order-customer').value = '';
  document.getElementById('order-date').value = new Date().toISOString().split('T')[0];
  document.getElementById('order-due-date').value = '';
  document.getElementById('order-items').value = '';
  document.getElementById('order-amount').value = '';
  document.getElementById('order-status').value = 'معلق';
  document.getElementById('order-priority').value = 'عادية';
  document.getElementById('order-alert').style.display = 'none';
}

function clearMaintenanceForm() {
  document.getElementById('maintenance-customer').value = '';
  document.getElementById('maintenance-date').value = new Date().toISOString().split('T')[0];
  document.getElementById('maintenance-expected-date').value = '';
  document.getElementById('maintenance-device-type').value = '';
  document.getElementById('maintenance-device-brand').value = '';
  document.getElementById('maintenance-device-model').value = '';
  document.getElementById('maintenance-problem').value = '';
  document.getElementById('maintenance-status').value = 'مستلم';
  document.getElementById('maintenance-cost').value = '';
  document.getElementById('maintenance-priority').value = 'عادية';
  document.getElementById('maintenance-notes').value = '';
  document.getElementById('maintenance-alert').style.display = 'none';
}

// ========== تحديث العرض ==========
function updateView() {
  const searchTerm = document.getElementById('search-input').value.toLowerCase();
  
  // تصفية البيانات
  let filteredCustomers = customers.filter(c => 
    (c.الاسم && c.الاسم.toLowerCase().includes(searchTerm)) || 
    (c.الهاتف && c.الهاتф.includes(searchTerm))
  );
  
  let filteredOrders = orders.filter(o => 
    (o['اسم العميل'] && o['اسم العميل'].toLowerCase().includes(searchTerm)) || 
    (o.المطلوب && o.المطلوب.toLowerCase().includes(searchTerm))
  );
  
  let filteredMaintenance = maintenance.filter(m => 
    (m['اسم العميل'] && m['اسم العميل'].toLowerCase().includes(searchTerm)) || 
    (m['نوع الجهاز'] && m['نوع الجهاز'].toLowerCase().includes(searchTerm))
  );
  
  // تحديث الإحصائيات
  document.getElementById('total-customers').textContent = filteredCustomers.length;
  document.getElementById('total-orders').textContent = filteredOrders.length;
  document.getElementById('total-maintenance').textContent = filteredMaintenance.length;
  document.getElementById('pending-maintenance').textContent = filteredMaintenance.filter(m => 
    m.الحالة && m.الحالة !== 'جاهز للتسليم' && m.الحالة !== 'مسلم'
  ).length;
  
  // تحديث العرض
  updateCustomersDisplay(filteredCustomers);
  updateMaintenanceDisplay(filteredMaintenance);
  updateOrdersDisplay(filteredOrders);
}

// ========== تحديث عرض العملاء ==========
function updateCustomersDisplay(filteredCustomers) {
  const container = document.getElementById('customers-container');
  const noData = document.getElementById('no-customers');
  
  if (filteredCustomers.length === 0) {
    container.innerHTML = '';
    noData.style.display = 'block';
    return;
  }
  
  noData.style.display = 'none';
  let html = '';
  
  filteredCustomers.forEach(customer => {
    const typeClass = getCustomerTypeClass(customer.النوع);
    html += `
      <div class="customer-card">
        <div class="customer-header">
          <div class="customer-name">${customer.الاسم || 'غير محدد'}</div>
          <span class="customer-type ${typeClass}">${customer.النوع || 'عادي'}</span>
        </div>
        <div class="customer-details">
          <p><i class="fas fa-phone"></i> ${customer.الهاتف || 'غير محدد'}</p>
          ${customer.البريد ? `<p><i class="fas fa-envelope"></i> ${customer.البريد}</p>` : ''}
          ${customer.العنوان ? `<p><i class="fas fa-map-marker-alt"></i> ${customer.العنوان}</p>` : ''}
          <p><i class="fas fa-calendar"></i> ${formatDate(customer['تاريخ التسجيل'])}</p>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// ========== تحديث عرض الصيانة ==========
function updateMaintenanceDisplay(filteredMaintenance) {
  const container = document.getElementById('maintenance-container');
  const noData = document.getElementById('no-maintenance');
  
  if (filteredMaintenance.length === 0) {
    container.innerHTML = '';
    noData.style.display = 'block';
    return;
  }
  
  noData.style.display = 'none';
  let html = '';
  
  filteredMaintenance.forEach(item => {
    const statusClass = getMaintenanceStatusClass(item.الحالة);
    html += `
      <div class="maintenance-card">
        <div class="maintenance-header">
          <div class="maintenance-customer">${item['اسم العميل'] || 'غير محدد'}</div>
          <div class="maintenance-date">${formatDate(item['تاريخ الاستلام'])}</div>
        </div>
        <div class="maintenance-details">
          <div class="maintenance-device">
            <i class="fas fa-laptop"></i> ${item['نوع الجهاز'] || 'غير محدد'}
            ${item.الماركة ? ` - ${item.الماركة}` : ''}
            ${item.الموديل ? ` - ${item.الموديل}` : ''}
          </div>
          <div class="maintenance-problem">${truncateText(item.المشكلة || '', 100)}</div>
          <p><strong>الحالة:</strong> <span class="maintenance-status ${statusClass}">${item.الحالة || 'مستلم'}</span></p>
          ${item.التكلفة > 0 ? `<p><strong>التكلفة:</strong> ${item.التكلفة} ريال</p>` : ''}
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// ========== تحديث عرض الطلبات ==========
function updateOrdersDisplay(filteredOrders) {
  const container = document.getElementById('orders-container');
  const noData = document.getElementById('no-orders');
  
  if (filteredOrders.length === 0) {
    container.innerHTML = '';
    noData.style.display = 'block';
    return;
  }
  
  noData.style.display = 'none';
  let html = '';
  
  filteredOrders.forEach(order => {
    const statusClass = getStatusClass(order.الحالة);
    html += `
      <div class="order-card">
        <div class="order-header">
          <div class="order-customer">${order['اسم العميل'] || 'غير محدد'}</div>
          <div class="order-date">${formatDate(order.التاريخ)}</div>
        </div>
        <div class="order-details">
          <p><strong>المطلوب:</strong> ${truncateText(order.المطلوب || '', 100)}</p>
          <p><strong>الحالة:</strong> <span class="order-status ${statusClass}">${order.الحالة || 'معلق'}</span></p>
          ${order.المبلغ > 0 ? `<p><strong>المبلغ:</strong> ${order.المبلغ} ريال</p>` : ''}
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// ========== دوال مساعدة ==========
function showLoading(message) {
  document.getElementById('loading-message').textContent = message;
  document.getElementById('loading-overlay').style.display = 'flex';
}

function hideLoading() {
  document.getElementById('loading-overlay').style.display = 'none';
}

function showAlert(elementId, message, type) {
  const element = document.getElementById(elementId);
  if (!element) return;
  
  element.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${message}`;
  element.className = `alert alert-${type}`;
  element.style.display = 'flex';
  
  setTimeout(() => {
    element.style.display = 'none';
  }, 5000);
}

function formatDate(dateString) {
  if (!dateString) return 'غير محدد';
  try {
    const date = new Date(dateString);
    return date.toLocaleDateString('ar-EG');
  } catch {
    return dateString;
  }
}

function truncateText(text, maxLength) {
  if (!text) return '';
  return text.length <= maxLength ? text : text.substring(0, maxLength) + '...';
}

function getStatusClass(status) {
  switch(status) {
    case 'معلق': return 'status-pending';
    case 'قيد التنفيذ': return 'status-processing';
    case 'منتهي': return 'status-completed';
    case 'ملغى': return 'status-cancelled';
    default: return 'status-pending';
  }
}

function getMaintenanceStatusClass(status) {
  switch(status) {
    case 'مستلم': return 'status-received';
    case 'قيد التشخيص': return 'status-diagnosis';
    case 'قيد الإصلاح': return 'status-repair';
    case 'جاهز للتسليم': return 'status-ready';
    case 'مسلم': return 'status-delivered';
    default: return 'status-received';
  }
}

function getCustomerTypeClass(type) {
  switch(type) {
    case 'عادي': return 'type-normal';
    case 'مميز': return 'type-vip';
    case 'جملة': return 'type-wholesale';
    case 'شركة': return 'type-company';
    default: return 'type-normal';
  }
}
</script>
</body>
</html>